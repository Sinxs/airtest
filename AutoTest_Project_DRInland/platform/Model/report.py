# -*- coding: utf-8 -*-__author__ = "Lee.le"from Model.tools import *from django.shortcuts import render, HttpResponse,HttpResponseRedirect, reverseimport shutilimport copyglobal reporthtmlglobal reportnamedef status(request):    """    展示测试报告    :param request:    :return:    """    # reportlist, htmlname = getreport()    if request.method == 'POST':        global reportname        reportname = request.POST.get("reportname")        delname = request.POST.get("delname")        if delname != None:            path = os.path.join(os.getcwd(), f"Controller\static\Report")            file = path + f'\\{delname}'            if (os.path.exists(file)):                shutil.rmtree(file)            # reportlist = getreport()        if reportname == None:            global reporthtml            reporthtml = ''        else:            reporthtml = f'.././static/Report/{reportname}/{reportname}.html'            # return HttpResponseRedirect('/info/')    else:        reporthtml = ''    reportlist, htmlname = getreport()    htmlstate = copy.deepcopy(reportlist) # copy一个新的字典    for i in htmlname:        file_Path = os.path.join(os.getcwd(), f"Controller\static\Report\\{i}\\{i}.html")  #判断是否生成实测报告，并且备注状态        file_Date = os.path.join(os.getcwd(), f"Controller\static\Report\\{i}")        filetime = os.stat(file_Date).st_ctime  # 文件创建时间        nowtime = time.time()  # 当前时间        overtime = (nowtime - filetime)        if os.path.exists(file_Path):            key = i.split("_")[1]            htmlstate[key] = 'done'        else:            if overtime > 9000:                key = i.split("_")[1]                htmlstate[key] = 'false'            else:                key = i.split("_")[1]                htmlstate[key] = 'doing'    if get_config("progress") == 0:        progressstatus = 0    else:        progressstatus = int(get_config("progress")/get_config("testcase")*100)    return render(request, "report.html", {'report': reportlist, 'htmlstate': htmlstate, 'addr': get_addr(), 'progressstatus': progressstatus})def reportinfo(request):    global reporthtml    global reportname    return render(request, "info.html", {'reporthtml': reporthtml, 'addr': get_addr(), 'reportname': '当前报告：' + reportname})def setprogress(request):    if get_config("progress") == 0:        progressstatus = 0    else:        progressstatus = int(get_config("progress")/get_config("testcase")*100)    return progressstatus